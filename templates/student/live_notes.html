{% extends "base.html" %}\n\n{% block title %}Live Notes{% endblock %}\n\n{% block content %}\n<div class=\"card\">\n    <h1>üé§ Live Lecture Notes</h1>\n    <p>AI-powered real-time transcription and note generation</p>\n</div>\n\n<div class=\"grid\">\n    <div class=\"card\">\n        <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;\">\n            <h3>üé§ Live Recording</h3>\n            <div style=\"display: flex; gap: 0.5rem; align-items: center;\">\n                <select id=\"language-select\" style=\"padding: 0.5rem; border-radius: 8px;\">\n                    <option value=\"en-US\">English</option>\n                    <option value=\"es-ES\">Spanish</option>\n                    <option value=\"fr-FR\">French</option>\n                    <option value=\"hi-IN\">Hindi</option>\n                </select>\n                <button id=\"start-recording\" class=\"btn btn-success\">üé§ Start</button>\n                <button id=\"stop-recording\" class=\"btn btn-danger\" disabled>‚èπÔ∏è Stop</button>\n            </div>\n        </div>\n        \n        <div id=\"recording-status\" style=\"margin-bottom: 1rem; padding: 0.75rem; background: var(--bg-secondary); border-radius: 8px;\">\n            <span style=\"color: var(--text-secondary);\">Select language and click \"Start\" to begin recording</span>\n        </div>\n        \n        <div>\n            <h4>üìù Live Transcript:</h4>\n            <div id=\"live-transcript\" style=\"background: var(--bg-secondary); padding: 1rem; border-radius: 8px; min-height: 200px; max-height: 300px; overflow-y: auto; font-family: monospace; line-height: 1.6;\">\n                Transcript will appear here as you speak...\n            </div>\n        </div>\n    </div>\n    \n    <div class=\"card\">\n        <h3>üìä Session Info</h3>\n        <div class=\"stats\">\n            <div class=\"stat-item\">\n                <h3 id=\"session-duration\">00:00</h3>\n                <p>Duration</p>\n            </div>\n            <div class=\"stat-item\">\n                <h3 id=\"word-count\">0</h3>\n                <p>Words</p>\n            </div>\n        </div>\n        \n        <div style=\"margin-top: 1rem; padding: 1rem; background: var(--bg-secondary); border-radius: 8px;\">\n            <p><strong>Language:</strong> <span id=\"current-language\">English</span></p>\n            <p><strong>Started:</strong> <span id=\"session-start\">--</span></p>\n        </div>\n    </div>\n</div>\n\n<div class=\"card\" id=\"notes-section\" style=\"display: none;\">\n    <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;\">\n        <h3>ü§ñ AI-Generated Notes</h3>\n        <div style=\"display: flex; gap: 0.5rem;\">\n            <button class=\"btn\" onclick=\"saveNotes()\">üíæ Save</button>\n            <button class=\"btn\" onclick=\"exportNotes()\">üì§ Export</button>\n        </div>\n    </div>\n    \n    <div id=\"processing-indicator\" style=\"text-align: center; padding: 2rem;\">\n        <div class=\"loading-spinner\" style=\"margin: 0 auto 1rem;\"></div>\n        <p>ü§ñ AI is processing your transcript and generating structured notes...</p>\n    </div>\n    \n    <div id=\"generated-notes\" style=\"display: none;\"></div>\n</div>\n\n<script>\nlet recognition;\nlet isRecording = false;\nlet sessionStartTime;\nlet durationInterval;\nlet fullTranscript = '';\n\nif ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {\n    recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();\n    recognition.continuous = true;\n    recognition.interimResults = true;\n    \n    recognition.onstart = function() {\n        isRecording = true;\n        sessionStartTime = new Date();\n        fullTranscript = '';\n        document.getElementById('recording-status').innerHTML = '<span style=\"color: var(--accent-green);\">üî¥ Recording... Speak now!</span>';\n        document.getElementById('start-recording').disabled = true;\n        document.getElementById('stop-recording').disabled = false;\n        document.getElementById('session-start').textContent = sessionStartTime.toLocaleTimeString();\n        document.getElementById('live-transcript').innerHTML = '';\n        \n        durationInterval = setInterval(updateDuration, 1000);\n    };\n    \n    recognition.onresult = function(event) {\n        let finalTranscript = '';\n        let interimTranscript = '';\n        \n        for (let i = event.resultIndex; i < event.results.length; i++) {\n            const transcript = event.results[i][0].transcript;\n            if (event.results[i].isFinal) {\n                finalTranscript += transcript + ' ';\n            } else {\n                interimTranscript += transcript;\n            }\n        }\n        \n        if (finalTranscript) {\n            fullTranscript += finalTranscript;\n            updateTranscriptDisplay();\n            updateWordCount();\n        }\n        \n        if (interimTranscript) {\n            const transcriptDiv = document.getElementById('live-transcript');\n            transcriptDiv.innerHTML = fullTranscript + '<span style=\"color: var(--accent-primary); opacity: 0.7;\">' + interimTranscript + '</span>';\n        }\n    };\n    \n    recognition.onerror = function(event) {\n        document.getElementById('recording-status').innerHTML = '<span style=\"color: var(--accent-red);\">‚ùå Error: ' + event.error + '</span>';\n    };\n    \n    recognition.onend = function() {\n        if (isRecording) {\n            recognition.start();\n        }\n    };\n} else {\n    document.getElementById('recording-status').innerHTML = '<span style=\"color: var(--accent-orange);\">‚ö†Ô∏è Speech recognition not supported in this browser</span>';\n}\n\ndocument.getElementById('language-select').addEventListener('change', function() {\n    const selectedLang = this.value;\n    const langNames = {\n        'en-US': 'English',\n        'es-ES': 'Spanish', \n        'fr-FR': 'French',\n        'hi-IN': 'Hindi'\n    };\n    \n    if (recognition) {\n        recognition.lang = selectedLang;\n    }\n    document.getElementById('current-language').textContent = langNames[selectedLang];\n});\n\ndocument.getElementById('start-recording').addEventListener('click', function() {\n    if (recognition) {\n        const selectedLang = document.getElementById('language-select').value;\n        recognition.lang = selectedLang;\n        recognition.start();\n    }\n});\n\ndocument.getElementById('stop-recording').addEventListener('click', function() {\n    if (recognition) {\n        isRecording = false;\n        recognition.stop();\n        clearInterval(durationInterval);\n        document.getElementById('recording-status').innerHTML = '<span style=\"color: var(--accent-primary);\">‚è∏Ô∏è Recording stopped. Processing transcript...</span>';\n        document.getElementById('start-recording').disabled = false;\n        document.getElementById('stop-recording').disabled = true;\n        \n        generateAINotes();\n    }\n});\n\nfunction updateDuration() {\n    if (sessionStartTime) {\n        const now = new Date();\n        const diff = Math.floor((now - sessionStartTime) / 1000);\n        const minutes = Math.floor(diff / 60);\n        const seconds = diff % 60;\n        document.getElementById('session-duration').textContent = \n            minutes.toString().padStart(2, '0') + ':' + seconds.toString().padStart(2, '0');\n    }\n}\n\nfunction updateTranscriptDisplay() {\n    document.getElementById('live-transcript').innerHTML = fullTranscript;\n}\n\nfunction updateWordCount() {\n    const words = fullTranscript.trim().split(/\\s+/).filter(word => word.length > 0);\n    document.getElementById('word-count').textContent = words.length;\n}\n\nfunction generateAINotes() {\n    if (!fullTranscript.trim()) {\n        alert('No transcript to process!');\n        return;\n    }\n    \n    document.getElementById('notes-section').style.display = 'block';\n    document.getElementById('processing-indicator').style.display = 'block';\n    document.getElementById('generated-notes').style.display = 'none';\n    \n    setTimeout(() => {\n        const aiNotes = processTranscriptWithAI(fullTranscript);\n        \n        document.getElementById('processing-indicator').style.display = 'none';\n        document.getElementById('generated-notes').style.display = 'block';\n        document.getElementById('generated-notes').innerHTML = aiNotes;\n    }, 3000);\n}\n\nfunction processTranscriptWithAI(transcript) {\n    const sentences = transcript.split(/[.!?]+/).filter(s => s.trim().length > 0);\n    \n    let notes = `\n        <div style=\"background: var(--bg-secondary); padding: 1.5rem; border-radius: 12px; margin-bottom: 1rem;\">\n            <h4>üìö Lecture Summary</h4>\n            <p><strong>Main Topic:</strong> ${extractMainTopic(transcript)}</p>\n            <p><strong>Duration:</strong> ${document.getElementById('session-duration').textContent}</p>\n            <p><strong>Word Count:</strong> ${document.getElementById('word-count').textContent} words</p>\n        </div>\n        \n        <div style=\"margin-bottom: 1rem;\">\n            <h4>üîë Key Points</h4>\n            <ul style=\"padding-left: 1.5rem;\">\n    `;\n    \n    const keyPoints = extractKeyPoints(sentences);\n    keyPoints.forEach(point => {\n        notes += `<li style=\"margin-bottom: 0.5rem;\">${point}</li>`;\n    });\n    \n    notes += `\n            </ul>\n        </div>\n        \n        <div>\n            <h4>üìù Detailed Notes</h4>\n    `;\n    \n    sentences.forEach((sentence, index) => {\n        if (sentence.trim().length > 20) {\n            notes += `<p><strong>Point ${index + 1}:</strong> ${sentence.trim()}.</p>`;\n        }\n    });\n    \n    notes += `\n        </div>\n        \n        <div style=\"margin-top: 1rem; padding: 1rem; background: var(--bg-secondary); border-radius: 8px; font-size: 0.9rem; color: var(--text-secondary);\">\n            <strong>Note:</strong> These notes were automatically generated using AI from the live transcript. \n            Please review and edit as needed for accuracy.\n        </div>\n    `;\n    \n    return notes;\n}\n\nfunction extractMainTopic(transcript) {\n    const words = transcript.toLowerCase().split(/\\s+/);\n    const commonWords = ['the', 'and', 'or', 'but', 'in', 'on', 'at', 'to', 'for', 'of', 'with', 'by'];\n    \n    const filteredWords = words.filter(word => !commonWords.includes(word) && word.length > 3);\n    const wordCount = {};\n    \n    filteredWords.forEach(word => {\n        wordCount[word] = (wordCount[word] || 0) + 1;\n    });\n    \n    const sortedWords = Object.entries(wordCount).sort((a, b) => b[1] - a[1]);\n    return sortedWords.length > 0 ? sortedWords[0][0].charAt(0).toUpperCase() + sortedWords[0][0].slice(1) : 'General Lecture';\n}\n\nfunction extractKeyPoints(sentences) {\n    return sentences\n        .filter(sentence => sentence.trim().length > 30)\n        .slice(0, 5)\n        .map(sentence => sentence.trim() + '.');\n}\n\nfunction saveNotes() {\n    const notes = document.getElementById('generated-notes').innerHTML;\n    if (notes) {\n        alert('AI-generated notes saved successfully!');\n    } else {\n        alert('No notes to save!');\n    }\n}\n\nfunction exportNotes() {\n    const notesElement = document.getElementById('generated-notes');\n    if (notesElement && notesElement.innerHTML) {\n        const notesText = notesElement.innerText;\n        const blob = new Blob([notesText], { type: 'text/plain' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `ai-lecture-notes-${new Date().toISOString().split('T')[0]}.txt`;\n        a.click();\n        URL.revokeObjectURL(url);\n    } else {\n        alert('No notes to export!');\n    }\n}\n</script>\n{% endblock %}