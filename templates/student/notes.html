{% extends "base.html" %}

{% block title %}Study Notes{% endblock %}

{% block content %}
<div class="card">
    <h1>Study Notes & Materials üìù</h1>
    <p>Access notes and exam materials shared by your TAs</p>
</div>

<div style="margin-bottom: 2rem;">
    <input type="text" placeholder="Search notes..." style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem;" onkeyup="searchNotes(this.value)">
</div>

<div style="display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap;">
    <button class="btn" onclick="filterNotes('all')" id="filter-all">All Notes</button>
    <button class="btn" onclick="filterNotes('math')" id="filter-math">Math</button>
    <button class="btn" onclick="filterNotes('physics')" id="filter-physics">Physics</button>
    <button class="btn" onclick="filterNotes('chemistry')" id="filter-chemistry">Chemistry</button>
    <button class="btn" onclick="filterNotes('exam')" id="filter-exam">Exam Prep</button>
</div>

{% if notes %}
<div class="grid" id="notesContainer">
    {% for note in notes %}
    <div class="card note-card" data-subject="{{ note.subject|lower }}" data-title="{{ note.title|lower }}">
        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
            <h3>{{ note.title }}</h3>
            <span style="background: #3498db; color: white; padding: 0.25rem 0.5rem; border-radius: 15px; font-size: 0.8rem;">
                {{ note.subject or 'General' }}
            </span>
        </div>
        
        <p style="color: #666; margin-bottom: 1rem;">{{ note.content[:150] }}{% if note.content|length > 150 %}...{% endif %}</p>
        
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <div>
                <p style="margin: 0; font-size: 0.9rem;"><strong>By:</strong> {{ note.ta.name }}</p>
                <p style="margin: 0; font-size: 0.8rem; color: #666;">{{ note.created_at.strftime('%B %d, %Y') }}</p>
            </div>
            <div style="display: flex; gap: 0.5rem;">
                <button class="btn" onclick="viewNote({{ note.id }})">View</button>
                <button class="btn" onclick="downloadNote({{ note.id }})">Download</button>
            </div>
        </div>
        
        <div style="display: flex; gap: 0.5rem;">
            <button style="background: none; border: none; color: #e74c3c; cursor: pointer;" onclick="toggleBookmark({{ note.id }})">
                ‚ù§Ô∏è Bookmark
            </button>
            <button style="background: none; border: none; color: #3498db; cursor: pointer;" onclick="shareNote({{ note.id }})">
                üì§ Share
            </button>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="card" style="text-align: center;">
    <h3>No notes available yet üìö</h3>
    <p>Your matched TAs will share study materials here</p>
    <a href="/student/matches" class="btn">Find TAs</a>
</div>
{% endif %}

<div class="card">
    <h3>üìä Study Materials Stats</h3>
    <div class="stats">
        <div class="stat-item">
            <h3>{{ notes|length }}</h3>
            <p>Total Notes</p>
        </div>
        <div class="stat-item">
            <h3>5</h3>
            <p>Bookmarked</p>
        </div>
        <div class="stat-item">
            <h3>12</h3>
            <p>Downloaded</p>
        </div>
        <div class="stat-item">
            <h3>3</h3>
            <p>Subjects</p>
        </div>
    </div>
</div>

<script>
let currentFilter = 'all';

function searchNotes(query) {
    const cards = document.querySelectorAll('.note-card');
    cards.forEach(card => {
        const title = card.dataset.title;
        const subject = card.dataset.subject;
        const visible = title.includes(query.toLowerCase()) || subject.includes(query.toLowerCase());
        card.style.display = visible ? 'block' : 'none';
    });
}

function filterNotes(subject) {
    currentFilter = subject;
    const cards = document.querySelectorAll('.note-card');
    
    // Update button styles
    document.querySelectorAll('[id^="filter-"]').forEach(btn => {
        btn.style.background = '#3498db';
    });
    document.getElementById(`filter-${subject}`).style.background = '#2980b9';
    
    cards.forEach(card => {
        const cardSubject = card.dataset.subject;
        const visible = subject === 'all' || cardSubject.includes(subject);
        card.style.display = visible ? 'block' : 'none';
    });
}

function viewNote(noteId) {
    fetch(`/api/note/${noteId}`)
    .then(response => response.json())
    .then(note => {
        const modal = document.createElement('div');
        modal.style.cssText = `
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.8); display: flex; justify-content: center; 
            align-items: center; z-index: 1000; overflow-y: auto;
        `;
        
        modal.innerHTML = `
            <div style="background: white; padding: 2rem; border-radius: 10px; max-width: 800px; max-height: 80vh; overflow-y: auto; margin: 2rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h2>${note.title}</h2>
                    <button onclick="closeModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">‚úï</button>
                </div>
                
                <div style="margin-bottom: 2rem;">
                    <p><strong>Subject:</strong> ${note.subject}</p>
                    <p><strong>Date:</strong> ${note.created_at}</p>
                </div>
                
                <div style="border-top: 1px solid #eee; padding-top: 2rem; white-space: pre-wrap;">
                    ${note.content}
                </div>
                
                <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                    <button class="btn" onclick="closeModal()">Close</button>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
    });
}

function downloadNote(noteId) {
    alert(`Downloading note ${noteId}... (Download feature coming soon!)`);
}

function toggleBookmark(noteId) {
    alert(`Note ${noteId} bookmarked!`);
}

function shareNote(noteId) {
    alert(`Sharing note ${noteId}... (Share feature coming soon!)`);
}

function closeModal() {
    const modal = document.querySelector('div[style*="position: fixed"]');
    if (modal) modal.remove();
}

// Initialize with all notes filter
filterNotes('all');
</script>
{% endblock %}