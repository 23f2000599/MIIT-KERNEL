{% extends "base.html" %}

{% block content %}
<h2>Find Your Teaching Assistant</h2>

<div class="row justify-content-center">
    <div class="col-md-6">
        {% if tas %}
            {% for ta in tas %}
            <div class="card mb-3 ta-card" id="ta-{{ ta[0] }}">
                <div class="card-body text-center">
                    <div class="profile-avatar mb-3">
                        <div class="avatar-circle">{{ ta[1][0].upper() }}</div>
                    </div>
                    <h5>{{ ta[1] }}</h5>
                    <p class="text-muted">{{ ta[2] }}</p>
                    <p>Specializes in Mathematics, Physics, and Computer Science</p>
                    <div class="rating mb-3">
                        <span class="text-warning">★★★★☆</span>
                        <span class="text-muted">(4.2/5)</span>
                    </div>
                    <div class="swipe-buttons">
                        <button class="btn btn-danger me-2" onclick="swipeTA({{ ta[0] }}, 'pass')">Pass</button>
                        <button class="btn btn-success" onclick="swipeTA({{ ta[0] }}, 'match')">Match</button>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="text-center">
                <h4>No more TAs available</h4>
                <p>You've seen all available teaching assistants. Check back later for new TAs!</p>
                <a href="{{ url_for('matches') }}" class="btn btn-primary">View Your Matches</a>
            </div>
        {% endif %}
    </div>
</div>

<script>
function swipeTA(taId, action) {
    if (action === 'match') {
        fetch('{{ url_for("match_ta") }}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'ta_id=' + taId
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                alert('Match request sent!');
            }
        });
    }
    
    // Hide the current TA card
    document.getElementById('ta-' + taId).style.display = 'none';
    
    // Check if there are more TAs
    let remainingCards = document.querySelectorAll('.ta-card:not([style*="display: none"])');
    if (remainingCards.length === 0) {
        document.querySelector('.col-md-6').innerHTML = `
            <div class="text-center">
                <h4>No more TAs available</h4>
                <p>You've seen all available teaching assistants. Check back later for new TAs!</p>
                <a href="{{ url_for('matches') }}" class="btn btn-primary">View Your Matches</a>
            </div>
        `;
    }
}
</script>

<style>
.avatar-circle {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background-color: #007bff;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    font-weight: bold;
    margin: 0 auto;
}

.ta-card {
    max-width: 400px;
    margin: 0 auto;
}
</style>
{% endblock %}